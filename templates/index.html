<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Leviosa – Speech to Text Video</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body{ background:#f4f6f9; }
    .navbar-brand{ font-weight:800; font-size:22px; }

    /* ===== STEPS ===== */
    .steps-wrap{ background:#eef1f4; padding:80px 0; }
    .step-card{
      background:#fff; border-radius:28px; padding:55px 45px; height:100%;
      box-shadow:0 10px 30px rgba(0,0,0,.06);
    }
    .step-icon{ width:110px; margin-bottom:30px; }
    .step-small{ font-size:13px; font-weight:700; letter-spacing:.6px; margin-bottom:14px; }
    .step-title{ font-size:36px; font-weight:800; line-height:1.1; margin-bottom:70px; }
    .step-desc{ font-size:18px; line-height:1.55; }

    /* ===== MAIN ===== */
    .main-card{ margin-top:60px; }
    textarea{ resize:vertical; font-size:16px; }
    #loadingBox{ display:none; }

    .mode-box{
      border:1px solid #ddd; border-radius:14px; padding:14px 14px;
      cursor:pointer; background:#fff;
    }
    .mode-box:hover{ border-color:#0d6efd; }
    .mode-box input{ margin-right:8px; }

    /* subtitle list */
    .subtitle-item{
      background:#fff; border:1px solid #e6e6e6; border-radius:12px;
      padding:12px 14px; margin-bottom:10px;
    }
    .subtitle-time{ font-size:12px; color:#6c757d; }
    .subtitle-text{ font-size:16px; margin-top:6px; }
  </style>
</head>

<body>
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">✨ Leviosa</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#">Trang chủ</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Giới thiệu</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Hướng dẫn</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- STEPS -->
  <div class="steps-wrap">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-4">
          <div class="step-card">
            <img class="step-icon" src="https://cdn-icons-png.flaticon.com/512/892/892311.png" alt="upload">
            <div class="step-small">BƯỚC 1</div>
            <div class="step-title">Tải video</div>
            <div class="step-desc">Chọn video (.mp4) có chứa giọng nói.</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="step-card">
            <img class="step-icon" src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" alt="ai">
            <div class="step-small">BƯỚC 2</div>
            <div class="step-title">Nhận diện giọng nói</div>
            <div class="step-desc">Leviosa dùng Whisper để xử lý âm thanh.</div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="step-card">
            <img class="step-icon" src="https://cdn-icons-png.flaticon.com/512/2991/2991112.png" alt="result">
            <div class="step-small">BƯỚC 3</div>
            <div class="step-title">Nhận kết quả</div>
            <div class="step-desc">Xem văn bản hoặc phụ đề tự động và tải xuống.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN -->
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-9">

        <div class="card shadow main-card">
          <div class="card-body">

            <h4 class="text-center text-primary mb-4">
              Leviosa – Speech to Text từ Video
            </h4>

            <!-- FORM -->
            <form method="POST" enctype="multipart/form-data" onsubmit="showLoading()">
              <div class="mb-3">
                <label class="form-label fw-bold">Chọn video (.mp4)</label>
                <input type="file" name="video" class="form-control" accept="video/mp4" required>
              </div>

              <!-- MODE -->
              <div class="mb-4">
                <label class="form-label fw-bold">Chọn kiểu kết quả:</label>
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="mode-box w-100">
                      <input type="radio" name="mode" value="text" {% if mode != 'subtitle' %}checked{% endif %}>
                      <b>Văn bản liền</b><br>
                      <small class="text-muted">Ghép toàn bộ nội dung thành một đoạn</small>
                    </label>
                  </div>
                  <div class="col-md-6">
                    <label class="mode-box w-100">
                      <input type="radio" name="mode" value="subtitle" {% if mode == 'subtitle' %}checked{% endif %}>
                      <b>Tách ra từng câu</b><br>
                      <small class="text-muted">Tách từng câu theo thời gian (Subtitle)</small>
                    </label>
                  </div>
                </div>
              </div>

              <div class="d-grid">
                <button id="submitBtn" type="submit" class="btn btn-primary btn-lg">
                  ✨ Bắt đầu chuyển đổi
                </button>
              </div>
            </form>

            <!-- LOADING -->
            <div id="loadingBox" class="alert alert-info mt-4 text-center">
              <div class="spinner-border text-primary mb-2"></div>
              <p class="mb-0">Leviosa đang xử lý video, vui lòng chờ...</p>
            </div>

            <hr class="my-4">

            <!-- ERROR -->
            {% if error %}
              <div class="alert alert-danger">
                {{ error }}
              </div>
            {% endif %}

            <!-- RESULT: TEXT -->
            {% if mode != "subtitle" %}
              <h5>Kết quả văn bản:</h5>
              {% if text %}
                <textarea class="form-control" rows="12">{{ text }}</textarea>
              {% else %}
                <div class="alert alert-secondary">
                  Chưa có kết quả. Hãy tải video và nhấn chuyển đổi.
                </div>
              {% endif %}
            {% endif %}

            <!-- RESULT: SUBTITLE -->
            {% if mode == "subtitle" %}
              <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0">Phụ đề tự động:</h5>

                {% if subtitles and subtitles|length > 0 %}
                  <a class="btn btn-outline-primary btn-sm"
                     href="/outputs/leviosa_subtitles.srt">
                    ⬇️ Tải .SRT
                  </a>
                {% endif %}
              </div>

              <div class="mt-3">
                {% if subtitles and subtitles|length > 0 %}
                  {% for s in subtitles %}
                    <div class="subtitle-item">
                      <div class="subtitle-time">
                        {{ "%.2f"|format(s.start) }}s → {{ "%.2f"|format(s.end) }}s
                      </div>
                      <div class="subtitle-text">{{ s.text }}</div>
                    </div>
                  {% endfor %}
                {% else %}
                  <div class="alert alert-secondary">
                    Chưa có phụ đề. Nếu bạn vừa chuyển đổi mà không thấy kết quả,
                    hãy thử video có lời nói rõ ràng (không quá ngắn / không im lặng).
                  </div>
                {% endif %}
              </div>

              {% if final_video_path %}
                <div class="mt-4">
                  <h5>Video có phụ đề:</h5>
                  <video width="100%" controls>
                    <source src="{{ final_video_path }}" type="video/mp4">
                  </video>
                  <br>
                  <a href="{{ final_video_path }}" class="btn btn-success mt-2">⬇️ Tải video có phụ đề</a>
                </div>
              {% endif %}
            {% endif %}

          </div>
        </div>

        <p class="text-center text-muted mt-4">
          © 2025 – Leviosa | Speech-to-Text & Auto Subtitle
        </p>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function showLoading(){
      document.getElementById("loadingBox").style.display = "block";
      const btn = document.getElementById("submitBtn");
      btn.disabled = true;
      btn.innerText = "Leviosa đang xử lý...";
    }
  </script>
</body>
</html>
